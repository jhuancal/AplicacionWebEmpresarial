<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SuperPet | Registrarse</title>

  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  
  <link rel="stylesheet" href="../static/css/login-register.css">

  <style>
    body {
      background-color: #191919;
      color: #fff;
      font-family: "Poppins", sans-serif;
      margin: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2rem;
    }

    .card {
      background: #fff;
      /* Temporarily white for contrast against dark body if css matches else override */
    }
  </style>

  
  <script>
    window.USER_SESSION = {{ user | tojson | safe if user else 'null' }};
  </script>

  
  <script type="module" src="/static/js/public/main.js"></script>
</head>

<body>
  <header>
    <header-component></header-component>
  </header>

  <main>
    <div class="card"
      style="max-width: 900px; width: 100%; display: flex; box-shadow: 0 15px 25px rgba(0,0,0,0.5); border-radius: 10px; overflow: hidden; background: #fff; color: #333;">
      <div class="container" style="display: flex; width: 100%;">
        
        <div class="form-box register" style="width: 50%; padding: 40px; background: #fff;">
          <form id="registerForm" style="display: flex; flex-direction: column; gap: 15px;">
            <h1 style="text-align: center; color: #b40500;">Registrarse</h1>

            <input type="text" id="txtNombres" class="form-control" placeholder="Nombres" required
              style="padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
            <input type="text" id="txtApellidos" class="form-control" placeholder="Apellidos" required
              style="padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
            <input type="text" id="txtDNI" class="form-control" placeholder="DNI" maxlength="20" required
              style="padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
            <input type="email" id="txtCorreo" class="form-control" placeholder="Correo" required
              style="padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
            <input type="text" id="txtUser" class="form-control" placeholder="Usuario" required
              style="padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
            <input type="password" id="txtPassword" class="form-control" placeholder="Contraseña" required
              style="padding: 10px; border: 1px solid #ccc; border-radius: 5px;">

            <button type="submit" class="btn"
              style="padding: 10px; background: #b40500; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">REGISTRAR</button>

            <p style="text-align: center; margin-top: 10px;">O regístrese con:</p>
            <div class="social-icons" style="display: flex; justify-content: center; gap: 15px;">
              <a href="#" style="color: #333; font-size: 1.5rem;"><i class="fa-brands fa-google"></i></a>
              <a href="#" style="color: #333; font-size: 1.5rem;"><i class="fa-brands fa-facebook"></i></a>
            </div>
          </form>
        </div>

        <div class="toggle-box"
          style="width: 50%; background: #b40500; display: flex; align-items: center; justify-content: center; color: white; text-align: center; flex-direction: column; padding: 20px;">
          <div class="toggle-panel toggle-right">
            <h1>Bienvenido</h1>
            <p>¿Ya tienes una cuenta?</p>
            <button class="btn login-btn" onclick="openLoginFromRegister()"
              style="padding: 10px 20px; background: transparent; border: 2px solid white; color: white; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px;">INICIAR
              SESIÓN</button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <footer-component></footer-component>
  </footer>

  
  <login-component></login-component>

  <script>
    // Handle opening login modal
    function openLoginFromRegister() {
      const loginComponent = document.querySelector('login-component');
      if (loginComponent) {
        loginComponent.open();
      } else {
        // If component not ready (unlikely), default to home
        window.location.href = '/';
      }
    }

    document.getElementById('registerForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const nombres = document.getElementById('txtNombres').value;
      const apellidos = document.getElementById('txtApellidos').value;
      const dni = document.getElementById('txtDNI').value;
      const email = document.getElementById('txtCorreo').value;
      const username = document.getElementById('txtUser').value;
      const password = document.getElementById('txtPassword').value;

      fetch('/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          nombres: nombres,
          apellidos: apellidos,
          dni: dni,
          email: email,
          username: username,
          password: password
        })
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Registro exitoso. Inicie sesión.');
            // Open Login Modal
            openLoginFromRegister();
          } else {
            alert('Error: ' + data.message);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Ocurrió un error al registrarse.');
        });
    });
  </script>
</body>

</html>