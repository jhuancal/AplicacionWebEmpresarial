{% extends "admin/base.html" %}

{% block title %}Vistas - SuperPet{% endblock %}

{% block styles %}
<style type="text/css">
    #treeTable {
        border: 1px solid #cddae3;
        background-color: #f9f9f9;
        min-height: 200px;
        /* Ensure visibility even if empty */
    }

    #treeContainer {
        border: 1px solid #ccc;
        padding: 10px;
        border-radius: 5px;
        background-color: #f9f9f9;
        width: 300px;
    }

    .ui-treetable-data {
        list-style: none;
        padding-left: 10px;
        padding-right: 10px;
        border-color: #cddae3;
    }

    .ui-treetable-data li {
        margin: 5px 0;
        padding: 5px;
        border: 1px solid #ddd;
        border-radius: 3px;
        cursor: grab;
        border-color: #cddae3;
        background: #fff;
    }

    .ui-treetable-data li .node-label {
        font-weight: bold;
    }

    .drag-over {
        background: #d3f9d8 !important;
    }

    .drop-ready-superior {
        border-top: 2px solid #5499c7 !important;
    }

    .drop-ready-inferior {
        border-bottom: 2px solid #5499c7 !important;
    }

    .drop-ready-child {
        background-color: #d3f9d8 !important;
    }

    #treeTable .fa-fw {
        margin-top: 1px;
        font-size: 13px;
    }
</style>
{% endblock %}

{% block content %}
<div id="content-container">
    <!-- Encabezado de página -->
    <div class="pageheader">
        <h3><i class="fa fa-shield"></i> Vistas </h3>
        <div class="breadcrumb-wrapper">
            <ol class="breadcrumb">
                <li><a href="#">Seguridad</a></li>
                <li class="active">Vistas</li>
            </ol>
        </div>
    </div>

    <!-- Contenido principal -->
    <div id="page-content">
        <div class="row">
            <div class="col-lg-12">
                <div class="panel">
                    <div class="panel-body">
                        <!-- Tabs -->
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="active">
                                <a href="#modulos-tab" id="modulos-registro-tab" role="tab" data-toggle="tab">
                                    <i class="fa fa-list-alt"></i> Módulos
                                </a>
                            </li>
                            <li>
                                <a href="#posicion-tab" role="tab" data-toggle="tab">
                                    <i class="fa fa-sitemap"></i> Posición
                                </a>
                            </li>
                        </ul>

                        <div class="tab-content mt-4" style="margin-top: 20px;">
                            <!-- TAB 1: Módulos -->
                            <div class="tab-pane active" id="modulos-tab">
                                <!-- Toolbar -->
                                <div class="row panel-search">
                                    <div class="col-sm-6 col-md-9 col-lg-9 table-toolbar-left"
                                        style="margin-bottom: 10px;">
                                        <div class="btn-group container-full">
                                            <button class="btn btn-default btn-cleft"
                                                onclick="eventClickOpenModalInsert()">
                                                <i class="fa fa-plus mr-1 text-success"></i> Nuevo registro
                                            </button>
                                            <button class="btn btn-default btn-cright" onclick="eventClickFiltro()">
                                                <i class="fa fa-search mr-1 text-success"></i> Buscar
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Filtro (Hidden mainly, simulated search dialog/area in JS usually expects explicit toggle) -->
                                <div id="filtroTable"
                                    style="display:none; background: #f0f0f0; padding: 15px; border-radius: 5px; margin-bottom: 15px;">
                                    <div class="row">
                                        <div class="col-lg-4 col-md-6">
                                            <div class="form-group row">
                                                <label class="col-lg-3 control-label">Tipo</label>
                                                <div class="col-lg-9">
                                                    <select id="dropTipoFiltro" class="form-control"></select>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-md-6">
                                            <div class="form-group row">
                                                <label class="col-lg-2 control-label">Valor</label>
                                                <div class="col-lg-10">
                                                    <input id="filtroValor" type="text" class="form-control"
                                                        autocomplete="off" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-md-12">
                                            <button class="btn btn-sm btn-info" onclick="eventClickBuscar()">
                                                <i class="fa fa-filter"></i> Filtrar
                                            </button>
                                            <button class="btn btn-sm btn-default" onclick="eventClickRefresh()">
                                                <i class="fa fa-refresh"></i> Reload
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tabla -->
                                <div class="panel-table mt-4">
                                    <div class="table-responsive">
                                        <table id="tableRegistros" class="table table-striped table-bordered mb-0">
                                            <thead>
                                                <tr>
                                                    <th class="text-center">Nº</th>
                                                    <th class="sorting text-center">Codigo Vista</th>
                                                    <th class="sorting text-center">Icono</th>
                                                    <th class="sorting text-center">Codigo</th>
                                                    <th class="sorting text-center">Nombre</th>
                                                    <th class="sorting text-center">Nivel</th>
                                                    <th class="sorting text-center">Codigo Padre</th>
                                                    <th class="sorting text-center">Url Vista</th>
                                                    <th class="text-center">Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Paginador (Simulated JS pagination) -->
                                <div class="panel-pag mt-3" style="margin-top: 10px;">
                                    <div class="row">
                                        <div class="col-md-6 text-left">
                                            <span id="labelRegistros"></span>
                                        </div>
                                        <div class="col-md-6 text-right">
                                            <ul class="pagination" style="margin: 0;"></ul>
                                            <select id="numRows" class="form-control input-sm d-inline-block ml-3"
                                                style="width: 70px; display: inline-block;">
                                                <option value="10">10</option>
                                                <option value="25">25</option>
                                                <option value="50">50</option>
                                                <option value="100">100</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- TAB 2: Posición -->
                            <div class="tab-pane" id="posicion-tab">
                                <div class="panel">
                                    <div class="panel-heading">
                                        <h4 class="panel-title">Posición</h4>
                                    </div>
                                    <div class="panel-body">
                                        <div class="row justify-content-center">
                                            <div class="col-lg-2"></div>
                                            <div class="col-lg-8" id="contentTree">
                                                <div id="treeTable"></div>
                                            </div>
                                        </div>
                                        <div class="text-right mt-4" style="margin-top: 15px;">
                                            <button id="btn-save" class="btn btn-sm btn-success"
                                                onclick="eventClickSaveVista()">Guardar</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Create -->
<div class="modal fade" id="dlgInsert" role="dialog" tabindex="-1" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog" style="width:60%;">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" class="close" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title"><span class="label-title new">NUEVO</span> REGISTRO</h4>
            </div>

            <div class="modal-body">
                <div class="panel" style="margin-bottom: 10px">
                    <div class="panel-body">
                        <div class="row innn-form">
                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Negocio</label>
                                    <select id="dropNegocio" class="form-control"></select>
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Padre</label>
                                    <select id="dropPadre" class="form-control"></select>
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Nombre Vista</label>
                                    <input id="txtNombreVista" type="text" class="form-control" autocomplete="off" />
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Icono</label>
                                    <select id="dropIcono" class="form-control">
                                        <option value="">Seleccione un Opcion</option>
                                        <option value="fa-home">fa-home</option>
                                        <option value="fa-edit">fa-edit</option>
                                        <option value="fa-user">fa-user</option>
                                        <option value="fa-cog">fa-cog</option>
                                        <option value="fa-th-large">fa-th-large</option>
                                        <option value="fa-user-plus">fa-user-plus</option>
                                        <option value="fa-shield">fa-shield</option>
                                        <option value="fa-lock">fa-lock</option>
                                        <option value="fa-key">fa-key</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">URL</label>
                                    <input id="txtUrlVista" type="text" class="form-control" autocomplete="off" />
                                </div>
                            </div>

                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Nivel</label>
                                    <select id="dropNivel" class="form-control"></select>
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Código Padre</label>
                                    <input id="txtCodigoPadre" type="text" class="form-control" autocomplete="off"
                                        disabled />
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Código Vista</label>
                                    <input id="txtCodigo" type="text" class="form-control" autocomplete="off" />
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Descripción</label>
                                    <input id="txtDescripcion" type="text" class="form-control" autocomplete="off" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="eventSaveItem()">Guardar</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Update -->
<div class="modal fade" id="dlgUpdate" role="dialog" tabindex="-1" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog" style="width:60%;">
        <div class="modal-content">
            <div class="modal-header">
                <button data-dismiss="modal" class="close" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title"><span class="label-title edit">ACTUALIZAR</span> REGISTRO</h4>
            </div>

            <div class="modal-body">
                <div class="panel" style="margin-bottom: 10px">
                    <div class="panel-body">
                        <div class="row innn-form">
                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Negocio</label>
                                    <select id="dropUpdNegocio" class="form-control"></select>
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Padre</label>
                                    <select id="dropUpdPadre" class="form-control"></select>
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Nombre Vista</label>
                                    <input id="txtUpdNombreVista" type="text" class="form-control" autocomplete="off" />
                                    <input type="hidden" id="idUpdOrden">
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Icono</label>
                                    <select id="dropUpdIcono" class="form-control">
                                        <option value="">Seleccione un Opcion</option>
                                        <option value="fa-home">fa-home</option>
                                        <option value="fa-edit">fa-edit</option>
                                        <option value="fa-user">fa-user</option>
                                        <option value="fa-cog">fa-cog</option>
                                        <option value="fa-th-large">fa-th-large</option>
                                        <option value="fa-user-plus">fa-user-plus</option>
                                        <option value="fa-shield">fa-shield</option>
                                        <option value="fa-lock">fa-lock</option>
                                        <option value="fa-key">fa-key</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">URL</label>
                                    <input id="txtUpdUrlVista" type="text" class="form-control" autocomplete="off" />
                                </div>
                            </div>

                            <div class="col-sm-6 col-md-6 col-lg-6">
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Nivel</label>
                                    <select id="dropUpdNivel" class="form-control"></select>
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Código Padre</label>
                                    <input id="txtUpdCodigoPadre" type="text" class="form-control" autocomplete="off"
                                        disabled />
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Código Vista</label>
                                    <input id="txtUpdCodigo" type="text" class="form-control" autocomplete="off" />
                                </div>
                                <div class="form-group">
                                    <label class="control-label innn-label-bold">Descripción</label>
                                    <input id="txtUpdDescripcion" type="text" class="form-control" autocomplete="off" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="eventUpdateItem()">Guardar</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    var urlGetAll = '/api/inm_seg_Vista/GetAll';
    var urlInsert = '/api/inm_seg_Vista/Insert';
    var urlUpdate = '/api/inm_seg_Vista/Update';
    var urlDelete = '/api/inm_seg_Vista/Delete';
    var urlGetVistaById = '/api/inm_seg_Vista/Getinm_seg_VistaById'; // Misnomer in original, kept to match controller
    var urlUpdateListaVistas = '/api/inm_seg_Vista/UpdateListaAcceso';
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="{{ url_for('static', filename='js/admin/Seguridad/inm_seg_Vistas.js') }}"></script>
{% endblock %}